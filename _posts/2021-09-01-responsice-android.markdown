---
layout:     post
title:      "RCS业务介绍"
date:       2021-09-01 11:58:00
author:     "Nela"
header-img: "img/post-bg-rwd.jpg"
tags:
- Android-Application
---

# GSMA-RCS

服务架构，运营商的架构参考标准

SIMPLE IM提供典型的基于SIP的消息功能、例如一对一和群组会话消息（即聊天）。这SIMPLE IM成为通信技术的以下技术标准的基础。自2005年以来、OMA MWG工作组（现称COM WG）开始开发融合IP消息（CPM）技术.该技术采用了SIMPLE IM的许多服务特性和技术.CPM通过将传统消息服务（例如、SMS、MMS、电子邮件等）集成到IP聊天功能、语音流、视频流等新服务中来提供融合通信服务功能.CPM还提供了一些功能、特别针对拥有多台设备的用户、为他们提供融合的通信环境和跨设备的一致用户体验。

## OMA SIMPLE IM架构

早期架构 RCSr4.0，主要专注于SIP/IP核心上实现IP消息传递功能

## CPM架构

RCSr5.0 .侧重于如何实现不同通信技术的融合体验，IP消息，语音。视频等

## RCSe

GSM协会（GSMA）于2011年4月首次指定富通讯套件演变（RCSe）标准、品牌名称为“Joyn”

运营商可能会觉得他们需要一个上市时间的服务、这种服务很简单、可以在短时间内建立起来。作为这种讨论的结果、他们想出了一个简单的RCS服务叫做“Joyn”。该服务基于RCSe、最后更新为RCSe r1.2.2

.RCSe r1.2.2的主要功能如下：

- 主设备（即PS访问设备）的基于HTTP的配置设置：向RCS设备提供服务相关配置.
- 服务能力发现：查找具有RCS功能的联系人的程序.IP消息系统（即一对一聊天、群聊）
- 存储和转发一对一聊天：如果收件人RCS用户不可用、暂时存储邮件、然后在用户可用时转发邮件
- 一对一的文件传输
- 基于GSMA的图像共享[IR.79]：与同伴进行语音通话的实时图像共享
- 基于GSMA的视频共享[IR.74]：与同伴进行语音通话的实时视频共享.
- 社交呈现信息共享（即匿名获取、可选）：查看联系人的社交呈现信息、如肖像图标、自由文本、最爱链接、可用性等。

## RCS架构

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1dc6d3a5-1db6-4522-a19b-81dec3220a9f/533933-20180721064421134-1830446479.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1dc6d3a5-1db6-4522-a19b-81dec3220a9f/533933-20180721064421134-1830446479.png)

RCSe已经采用了SIMPLE IM的即时消息服务器，并正在重用其他服务引擎如Presence和XDMS。

RCS r5.x增强了每个组件的功能，并且还集成了来自OMA CPM的一些功能组件,消息存储服务器和互通功能

所有SIP业务都穿过IMS网络，而其余协议业务即XCAP，HTTP，MSRP和IMAPv4将经过RCS客户端和相应应用服务器之间的相应直接接口

GSMA RCS允许运营商使用OMA数据管理（DM）或OMA内容提供（CP）启用码作为默认配置供应技术

### Presence服务器

Presence服务器基于OMA SIMPLE存在v1.1体系结构。它在RCS上下文中用于支持社交呈现信息共享和基于状态的服务功能发现功能。社交呈现信息是RCS用户间的共享对象，其中包括肖像图标，收藏夹链接，自由文本，可用性，意愿和地理位置信息。运营商可以进一步定义自己的项目，以提供差异化的RCS服务。

Presence服务器与XDMS互操作以存储和检索社交呈现信息，用户简档和RCS联系人列表。 XDMS管理RCS用户的配置文件和各种组信息，如RCS联系人组，被阻止的联系组，被撤销的联系组等.XDMS基于OMA XDM v1.0和v2.0架构。一旦RCS客户端在被调用后完成服务能力发现过程，它将连接到XDMS并执行目录服务，以检索存储在XDMS中的所有RCS用户的XML文档。如果没有存储XML文档，这是第一次访问RCS服务时的典型情况，则RCS客户端应创建新的XML文档（即RCS联系人组，用户配置文件，用户首选项，组列表）并将其上传到XDMS。 Presence服务器必须支持XCAP接口来存储/检索这些呈现XML文档。 XDMS可以包括但不限于共享XDMS，存在XDMS，聚合代理以及用于网络 - 网络接口（NNI）的交叉网络代理子系统。

### 会话服务器

会话服务器基于OMA SIMPLE IM v1.0的IM服务器或OMA CPM v1.0的会话服务器。它由参与功能（PF）和控制功能（CF）组成。 PF提供UNI功能并处理所有RCS信令和媒体控制，以实现IP聊天，文件传输，独立消息传递等一对一通信。所有针对多个接收者的RCS消息（即组通信）都被转发给CF. CF通过处理RCS组相关程序担任会议焦点。如果目标用户被解析为非RCS用户，则会话服务器应通过SIP / IP核心将RCS消息与互通功能（IWF）互通。

对话服务器充当IMAPv4客户端以将对话历史存储在集中式消息存储器中。消息存储服务器存储和检索RCS客户端之间交换的所有RCS消息和内容。如果RCS用户有多个设备，则可以使用IMAPv4在所有用户的多个设备上同步对话历史记录。 RCS用户可以在存储库中创建一个新目录来管理他/她自己的对话历史记录。任何与消息存储服务器交互的节点都应该作为IMAPv4客户端。

### IWF

IWF执行RCS消息和SMS和MMS等传统消息之间的协议转换，并将转换后的消息转发给非RCS用户，反之亦然。 IWF由SMS-IWF和MMS-IWF功能组件组成，可能包括互通选择功能（ISF）。 ISF确定使用哪个传统消息服务以将RCS消息中继给非RCS用户。 ISF可以基于内容类型和内容长度来确定特定的IWF功能组件，并且/或者运营商可以定义它们自己的标准来选择互通功能。 SMS-IWF可以与短消息服务中心（SM-SC）或IP-SM-GW互通以进行SMS互通。在SM-SC互通的情况下，使用SMPP接口，SMS-IWF作为SIP领域的终点。在IPSM-GW互通的情况下，IP-SM-GW扮演SIP端点的角色。因此，SMS-IWF提供了朝向IMS核心的SIP接口以接入IP-SM-GW。 SMS-IWF还应具有与IP-SM-GW的MSRP接口来传递RCS消息。当谈到MMS互通时，MMS-IWF与多媒体服务中心（MMSC）有一个MM4接口

### OPTIONS AS

OPTIONS AS（OAS）在RCS用户之间提供基于SIP OPTIONS的服务能力发现功能。服务能力发现可以基于轮询时间（由供应服务器供应）周期性地发生，或者也可以根据用户请求发生。基于SIP选项的服务能力发现应该应用于RCS用户地址簿的非RCS联系人。在接收者（即联系人）具有多个设备的情况下，OAS必须执行服务级分叉并聚集来自个体接收者的设备的结果。 OPTIONS AS可以与会话服务器建立SIP接口，SIP OPTIONS可以从该会话服务器转发，或者可以通过IMS核心与RCS客户端建立直接接口。

### 视频共享服务器

视频共享服务器基于RCSe中的GSMA IR.74和RCS r1.0至r3.0提供视频共享服务功能。

GSMA IR.74规定视频共享会话取决于现有的语音会话。视频共享会话仅在存在语音会话时才可用。如果语音会话关闭，则视频共享会话也应与语音会话一起关闭。如果通过例如呼叫保持，呼叫转移等以某种方式影响语音会话，则视频共享会话也将被关闭。

同时，从RCS 4.0及以上开始，RCS采用GSMA IR.84进行视频共享服务。在基于GSMA IR.84的视频共享服务中，视频共享会话不具有对现有语音会话的任何依赖性。也就是说，无论是否有正在进行的语音会话，RCS用户都可以建立视频共享会话。视频共享服务器具有与IMS核心的ISC接口。

## R5.x

GSMA RCS r5基于RCS r4和RCSe r1.2.2

RCS r5已经发展到RCS r5.4.RCS r5.x打算整合基于IP网络的所有通信功能

RCS r5.1的主要特性可概括如下：

- 在RCS r5.1中扩展了配置调配、以适应非PS接入设备和RCS用户的辅助设备。还添加了许多配置参数.独立消息传递提供了与SMS / MMS相同的用户体验、因为两者都是无会话通信。根据要发送的消息的大小、在独立消息中定义了两种模式：Page寻呼模式消息传送（<= 1,300字节）Large大消息模式消息传送（> 1,300字节）IP内的多媒体聊天会话已被允许在RCS r5.1中.RCS用户可以在IP聊天会话中发送多媒体内容。如果多媒体内容大于聊天会话允许的内容、则使用文件传输机制发送。文件传输会话将与现有聊天会话分开、以便并行处理。即使当内容作为文件传送发送并且在单独的会话中时、RCS用户仍然可以在现有聊天会话的相同对话上下文中查看传送的多媒体内容.
- 群聊中的存储和转发提高了群聊过程中消息传递的可靠性。由于连接丢失、电池电量耗尽等原因导致与群组会话非自愿断开的参与者可以在设备重新连接后重新加入群组会话。重新加入的参与者可以接收所有在断开连接时错过的RCS消息（基本存储和转发）。即使是迟到参加集体会议的人也可以收到完整的对话历史记录（完整存储和转发）.
- Group会话重启（Long Lived Group）捕捉OTT服务中提供的当前用户体验、用户可以通过在存储在本地设备中的会话线程发送任何消息来开始聊天会话。在RCS r5.1中、如果闲置计时器过期、则会发布群聊会话。在群组会话关闭后、只要不删除它、对话历史将保留在参与者的本地设备中。因此、任何用户都可以通过在对话历史记录线程中发送新的聊天消息或文件来重新启动相同的群组会话。为了重新启动组会话、组会话标识应保存在RCS系统中。如果由于相应的组会话标识符已从RCS系统中删除而无法重新启动组会话、RCS客户端可能会自动尝试启动新的组会话.
- 基于HTTP和MSRP的文件传输用于HTTP或MSRP进行文件传输。在使用HTTP的情况下、要发送的文件由发起者上传到网络中的特定内容存储器、并且获得存储的对象的位置URL作为回报。位置URL通过聊天会话或作为独立消息发送给收件人。收件人可以从收到的位置URL中检索文件.文件传输缩略图预览用于在文件传输请求中将缩略图连同其他文件信息（如文件名、文件类型、文件大小等）发送给收件人。接收方RCS用户可以根据此信息确定是否接受文件传输请求.文件传输暂停和恢复用于在文件传输过程中暂停文件传输、并在需要时恢复。由于其他原因、文件传输也可能会意外暂停、例如连接丢失。如果稍后由最终用户恢复文件传输、则可以从暂停的位置传输文件。要在多设备环境中恢复暂停传输、RCS用户需要使用相同的设备。否则、文件传输将从头开始、因为该设备中没有文件片段.文件传输存储和转发用于在收件人不可用时临时存储文件、然后在收件人变为可用时再将其传输.组会话中的文件传输用于在组会话的上下文中传输文件
- 通过调整RCS用户的位置信息、RCS r5.1丰富了社交存在信息。社交存在信息应该由已经建立了社交存在关系的RCS用户共享.
- VIP联系人是实时向RCS用户通知其社交呈现信息变化的联系人类型。如果与RCS用户处于社交在线关系的联系人不是VIP联系人、则RCS用户需要对该联系人执行一次性订阅以查看他/她的社交呈现信息.
- 基于网络的个人黑名单可以由RCS用户创建/删除/修改。来自黑名单中的联系人的任何RCS消息或通信尝试都将被阻止.地理位置共享推/拉用于在RCS用户之间共享地理位置信息.RCS用户可以将他/她的位置信息推送到RCS联系人（推送）或请求联系人的位置信息（拉）
- 内容共享用于在RCS用户之间实时共享图像或视频剪辑。在RCSe中、内容共享功能依赖于现有的语音呼叫会话、这意味着内容共享功能仅在存在语音呼叫会话时才可用。而RCS r5.1中的内容共享功能独立于语音呼叫会话.RCS用户可以使用内容共享服务作为独立的服务功能.基于网络的消息存储用于存储RCS用户的对话历史记录。存储在基于网络的消息存储器中的对话历史可以与RCS用户的一个或多个设备同步。基于网络的消息存储功能为用户提供跨多个设备的一致用户体验.
- 传统消息互通是RCS r5.1的一项支持功能、包括SMS和MMS。鉴于此功能、无论消息类型如何、所有对话历史都集成在同一个对话线程中。
- IP语音/视频呼叫和VoLTE与IP聊天功能一起集成在RCS r5.1中。

## RCS标准演进

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5bef764b-e3a2-4872-a679-a5addb917f8c/1584610329OrpUCCEV.jpeg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5bef764b-e3a2-4872-a679-a5addb917f8c/1584610329OrpUCCEV.jpeg)

### 双注册方案

双注册指RCS和VoLTE相互独立，需要保活两个注册连接，VoLTE使用IMS APN承载，RCS使用Internet APN承载，IMS需要支持Internet APN接入，待机的功耗和流量较高。双协议栈理论上内存占用也较多。但双注册开发难度较小，通用性强，非终端厂家也可以参与开发。双注册Native和APP并存。单双注册架构如图2所示。

一些早期RCS和VoLTE结合的终端会有RCS客户端和VoLTE客户端各自独立实现方式。RCS客户端驻留在终端的AP部分，而VoLTE客户端驻留在芯片处。RCS要使用互联网APN或者通过Wi-Fi连接到移动无线接入网；VoLTE则要使用专用的、标准名称的IMS APN连接到运营商的无线接入网

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1a2d0f00-0af4-4a1e-97fb-3a3042991b99/526604d673c53-thumb.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1a2d0f00-0af4-4a1e-97fb-3a3042991b99/526604d673c53-thumb.jpg)

### 单注册方案

单注册即RCS复用VoLTE的协议栈，共用IMS APN，有QoS保障，可提供MSRP的QoS保障。与芯片平台强关联，需要芯片厂家封装提供VoLTE协议栈的调用接口。其优点是保活一个注册连接，待机的功耗和流量较低，单协议栈，理论上内存占用少。缺点是RCS和VoLTE完全耦合，开发难度大，主要依赖终端厂家开发，开发周期长，业务灵活性受限。单注册以Native为主

一种方式是，在终端芯片中提供一个共用的IMS协议栈，同时引入一个新的API接口，位于芯片和高层操作系统（OS）/应用处理器（AP）之间，服务于RCS应用和IMS协议之间的调用，如图2.另一种方式是，允许多个客户端（应用）自带自己的IMS协议栈，但是在芯片里引入一个简化的IMS B2BUA/Proxy模块，它能聚合相关的IMS信令，并且在网络看来，它提供唯一一个整合后的IMS接口，如图3.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/eb1fff6b-992c-453b-b354-ec19ea17f6d7/526604d684d82-thumb.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/eb1fff6b-992c-453b-b354-ec19ea17f6d7/526604d684d82-thumb.jpg)

### 单注册双注册对比

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3d8ab2b0-6fbb-4741-aad5-fb5b8bb09a9e/1584610731ZOd1cSrU.jpeg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3d8ab2b0-6fbb-4741-aad5-fb5b8bb09a9e/1584610731ZOd1cSrU.jpeg)

### VOLTE

VoLTE是基于IMS的语音业务

[https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7cb4d766-f65e-448e-b109-87ccdabb3043/20180727142229427.jfif](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7cb4d766-f65e-448e-b109-87ccdabb3043/20180727142229427.jfif)

VoLTE用户注册：

VoLTE用户在体验高质量通话之前，必须先进行VoLTE的注册流程，从无线角度来看，注册分为两个步骤：

(1)LTE无线的无线注册: 由于VoLTE实质上对于无线来说只是一种数据业务，所以，E-UTRAN网络需要为VoLTE提供数据发送的通道。即，建立QCI=8/9的承载。

(2)IMS注册：支持VoLTE的终端在完成LTE的注册后，会通过LTE的承载向IMS网元发起注册(类似于高层应用的注册)，即，建立QCI=5的承载；在该注册完成后，用户就可以使用VoLTE进行语音通话了。即，会触发核心网建立一条QCI=1的专用承载用于传输IMS语音包。

IMSService

google AndroidFrameWork对RCS进行支持

ImsService

[https://source.android.google.cn/devices/tech/connect/ims](https://source.android.google.cn/devices/tech/connect/ims)

IMS 规范非常多且使用的是特殊验证设备，因此测试套件中不包含验证 IMS 实现本身的工具。这些测试只能验证电话框架是否正确响应 ImsService API。